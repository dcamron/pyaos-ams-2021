
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>python-awips: Working with Upper Air Obs &#8212; Unidata AMS 2021 Python Workshop</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&display=swap');
</style>
    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    

    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/theme-unidata.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Enhancing Your Notebooks" href="../notebook_enhancements.html" />
    <link rel="prev" title="python-awips: Working with Surface Obs" href="python-awips-WorkingWithSurfaceObs.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
  <nav class="navbar navbar-dark navbar-expand-lg bg-unidata fixed-top bd-navbar shadow" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../../index.html">
    
      <img src="../../_static/Unidata_logo_horizontal.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../agenda.html">Agenda</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../setup.html">Workshop Environment</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../projects.html">Project Ideas</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../../resources.html">Resources</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../showcase.html">Workshop Showcase</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/Unidata/pyaos-ams-2021" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/Unidata" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
  </nav>


    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="../dataAccess.html">Data Access Notebooks</a>
                </li>
            
          
            
                <li class="">
                    <a href="../analysis.html">Analysis Notebooks</a>
                </li>
            
          
            
  
                <li class="active">
                    <a href="../visualization.html">Visualization Notebooks</a>
                    <ul>
                    
                        <li class="">
                            <a href="Declarative-Example.html">Declarative Syntax Example</a>
                        </li>
                    
                        <li class="">
                            <a href="MetPy%20SkewT.html">MetPy Skew-T</a>
                        </li>
                    
                        <li class="">
                            <a href="isentropic_introduction.html">Overview of Isentropic Analysis</a>
                        </li>
                    
                        <li class="">
                            <a href="matplotlib-basics.html">Matplotlib: Basics</a>
                        </li>
                    
                        <li class="">
                            <a href="matplotlib-intermediate.html">Matplotlib: Intermediate</a>
                        </li>
                    
                        <li class="">
                            <a href="python-awips-WorkingWithMapsTopoDatabases.html">python-awips: Working with the Maps and Topo Databases</a>
                        </li>
                    
                        <li class="">
                            <a href="python-awips-WorkingWithModels.html">python-awips: Working with Models</a>
                        </li>
                    
                        <li class="">
                            <a href="python-awips-WorkingWithSatelliteData.html">python-awips: Working with Satellite Data</a>
                        </li>
                    
                        <li class="">
                            <a href="python-awips-WorkingWithSurfaceObs.html">python-awips: Working with Surface Obs</a>
                        </li>
                    
                        <li class="active">
                            <a href="">python-awips: Working with Upper Air Obs</a>
                        </li>
                    
                    </ul>
                </li>
            
          
            
                <li class="">
                    <a href="../notebook_enhancements.html">Enhancing Your Notebooks</a>
                </li>
            
          
            
                <li class="">
                    <a href="../index.html">Notebook Index</a>
                </li>
            
          
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#unidata-ams-2021-student-conference" class="nav-link">Unidata AMS 2021 Student Conference</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#focuses" class="nav-link">Focuses</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#objectives" class="nav-link">Objectives</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#imports" class="nav-link">Imports</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#define-data-request" class="nav-link">1. Define Data Request</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#limit-results-based-on-time" class="nav-link">2. Limit Results Based on Time</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#get-the-data" class="nav-link">3. Get the Data!</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#prepare-the-data" class="nav-link">4. Prepare the Data</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#draw-the-plot" class="nav-link">5. Draw the Plot</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#see-also" class="nav-link">See also</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#related-notebooks" class="nav-link">Related Notebooks:</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <p><a name="top"></a></p>
<div style="width:1000 px">
<div style="float:right; width:98 px; height:98px;">
<img src="https://raw.githubusercontent.com/Unidata/MetPy/master/src/metpy/plots/_static/unidata_150x150.png" alt="Unidata Logo" style="height: 98px;">
</div>
<div class="section" id="python-awips-working-with-upper-air-obs">
<h1>python-awips: Working with Upper Air Obs<a class="headerlink" href="#python-awips-working-with-upper-air-obs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="unidata-ams-2021-student-conference">
<h2>Unidata AMS 2021 Student Conference<a class="headerlink" href="#unidata-ams-2021-student-conference" title="Permalink to this headline">¶</a></h2>
<div style="clear:both"></div>
</div>
<hr class="docutils" />
<div style="float:right; width:250 px"><img src="../../_static/images/python-awips-upper-air-preview.png" alt="Upper air vertical profile Skew-T/Log-P plot" style="height: 300px;"></div>
</div>
<div class="section" id="focuses">
<h2>Focuses<a class="headerlink" href="#focuses" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Retreive upper air vertical profile data from EDEX server.</p></li>
<li><p>Use EDEX to get the pressure, temperature, dewpoint lines and wind profile data for the Upper Air observation.</p></li>
<li><p>Plot a Skew-T/Log-P plot with Hodograph using Matplotlib and Metpy.</p></li>
</ul>
</div>
<div class="section" id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#1.-Define-Data-Request">Define Data Request</a></p></li>
<li><p><a class="reference external" href="#2.-Limit-Results-Based-on-Time">Limit Results Based on Time</a></p></li>
<li><p><a class="reference external" href="#3.-Get-the-Data%21">Get the Data!</a></p></li>
<li><p><a class="reference external" href="#4.-Prepare-the-Data">Prepare the Data</a></p></li>
<li><p><a class="reference external" href="#5.-Draw-the-Plot">Draw the Plot</a></p></li>
</ol>
</div>
<hr class="docutils" />
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">awips.dataaccess</span> <span class="kn">import</span> <span class="n">DataAccessLayer</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">mtri</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">metpy.calc</span> <span class="kn">import</span> <span class="n">wind_speed</span><span class="p">,</span> <span class="n">wind_components</span><span class="p">,</span> <span class="n">lcl</span><span class="p">,</span> <span class="n">dry_lapse</span><span class="p">,</span> <span class="n">parcel_profile</span>
<span class="kn">from</span> <span class="nn">metpy.plots</span> <span class="kn">import</span> <span class="n">SkewT</span><span class="p">,</span> <span class="n">Hodograph</span>
<span class="kn">from</span> <span class="nn">metpy.units</span> <span class="kn">import</span> <span class="n">units</span><span class="p">,</span> <span class="n">concatenate</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-data-request">
<h2>1. Define Data Request<a class="headerlink" href="#define-data-request" title="Permalink to this headline">¶</a></h2>
<p>If you read through the <a class="reference external" href="https://nbviewer.jupyter.org/github/Unidata/pyaos-ams-2021/blob/master/notebooks/dataAccess/python-awips-HowToAccessData.ipynb">python-awips: How to Access Data</a> training, you will know that we need to set an EDEX url to access our server, and then we create a data request.  In this example we use <em>bufrua</em> as the data type to define our request.  We also set some <em>parameters</em> and the <em>location name</em>.
The <strong>bufrua</strong> plugin returns separate objects for parameters at <strong>mandatory levels</strong> and at <strong>significant temperature levels</strong>.  For the Skew-T/Log-P plot, significant temperature levels are used to plot the pressure, temperature, and dewpoint lines, while mandatory levels are used to plot the wind profile.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an EDEX data request</span>
<span class="n">DataAccessLayer</span><span class="o">.</span><span class="n">changeEDEXHost</span><span class="p">(</span><span class="s2">&quot;edex-cloud.unidata.ucar.edu&quot;</span><span class="p">)</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">DataAccessLayer</span><span class="o">.</span><span class="n">newDataRequest</span><span class="p">()</span>
<span class="n">request</span><span class="o">.</span><span class="n">setDatatype</span><span class="p">(</span><span class="s2">&quot;bufrua&quot;</span><span class="p">)</span>

<span class="c1"># set parameters, including the mandatory and significant parameters</span>
<span class="n">MAN_PARAMS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;prMan&#39;</span><span class="p">,</span> <span class="s1">&#39;htMan&#39;</span><span class="p">,</span> <span class="s1">&#39;tpMan&#39;</span><span class="p">,</span> <span class="s1">&#39;tdMan&#39;</span><span class="p">,</span> <span class="s1">&#39;wdMan&#39;</span><span class="p">,</span> <span class="s1">&#39;wsMan&#39;</span><span class="p">])</span>
<span class="n">SIGT_PARAMS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;prSigT&#39;</span><span class="p">,</span> <span class="s1">&#39;tpSigT&#39;</span><span class="p">,</span> <span class="s1">&#39;tdSigT&#39;</span><span class="p">])</span>
<span class="n">request</span><span class="o">.</span><span class="n">setParameters</span><span class="p">(</span><span class="s2">&quot;wmoStaNum&quot;</span><span class="p">,</span> <span class="s2">&quot;validTime&quot;</span><span class="p">,</span> <span class="s2">&quot;rptType&quot;</span><span class="p">,</span> <span class="s2">&quot;staElev&quot;</span><span class="p">,</span> <span class="s2">&quot;numMand&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;numSigT&quot;</span><span class="p">,</span> <span class="s2">&quot;numSigW&quot;</span><span class="p">,</span> <span class="s2">&quot;numTrop&quot;</span><span class="p">,</span> <span class="s2">&quot;numMwnd&quot;</span><span class="p">,</span> <span class="s2">&quot;staName&quot;</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">getParameters</span><span class="p">()</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">MAN_PARAMS</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">getParameters</span><span class="p">()</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SIGT_PARAMS</span><span class="p">)</span>

<span class="c1"># Set station ID (not name)</span>
<span class="n">request</span><span class="o">.</span><span class="n">setLocationNames</span><span class="p">(</span><span class="s2">&quot;72562&quot;</span><span class="p">)</span> <span class="c1">#KLBF</span>

<span class="c1"># Take a look at our request</span>
<span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DefaultDataRequest(datatype=bufrua, identifiers={}, parameters=[&#39;wmoStaNum&#39;, &#39;validTime&#39;, &#39;rptType&#39;, &#39;staElev&#39;, &#39;numMand&#39;, &#39;numSigT&#39;, &#39;numSigW&#39;, &#39;numTrop&#39;, &#39;numMwnd&#39;, &#39;staName&#39;, &#39;tdMan&#39;, &#39;wsMan&#39;, &#39;tpMan&#39;, &#39;htMan&#39;, &#39;prMan&#39;, &#39;wdMan&#39;, &#39;prSigT&#39;, &#39;tpSigT&#39;, &#39;tdSigT&#39;], levels=[], locationNames=[&#39;72562&#39;], envelope=None)
</pre></div>
</div>
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="limit-results-based-on-time">
<h2>2. Limit Results Based on Time<a class="headerlink" href="#limit-results-based-on-time" title="Permalink to this headline">¶</a></h2>
<p>There can be data from multiple time points, so let’s limit to the most recent time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get all times</span>
<span class="n">datatimes</span> <span class="o">=</span> <span class="n">DataAccessLayer</span><span class="o">.</span><span class="n">getAvailableTimes</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="c1"># Get most recent record</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">DataAccessLayer</span><span class="o">.</span><span class="n">getGeometryData</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">times</span><span class="o">=</span><span class="n">datatimes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">validPeriod</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="get-the-data">
<h2>3. Get the Data!<a class="headerlink" href="#get-the-data" title="Permalink to this headline">¶</a></h2>
<p>Now that we have the the data response, create arrays to store all the vertical profile data.  Then, cycle through the objects in the response to populate all the data arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize data arrays</span>
<span class="n">tdMan</span><span class="p">,</span><span class="n">tpMan</span><span class="p">,</span><span class="n">prMan</span><span class="p">,</span><span class="n">wdMan</span><span class="p">,</span><span class="n">wsMan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">prSig</span><span class="p">,</span><span class="n">tpSig</span><span class="p">,</span><span class="n">tdSig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">manGeos</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sigtGeos</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Build  arrays</span>
<span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
    <span class="n">parm_array</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">getParameters</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">parm_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">MAN_PARAMS</span><span class="p">:</span>
        <span class="n">manGeos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
        <span class="n">prMan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prMan</span><span class="p">,</span><span class="n">ob</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;prMan&quot;</span><span class="p">))</span>
        <span class="n">tpMan</span><span class="p">,</span> <span class="n">tpUnit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpMan</span><span class="p">,</span><span class="n">ob</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;tpMan&quot;</span><span class="p">)),</span> <span class="n">ob</span><span class="o">.</span><span class="n">getUnit</span><span class="p">(</span><span class="s2">&quot;tpMan&quot;</span><span class="p">)</span>
        <span class="n">tdMan</span><span class="p">,</span> <span class="n">tdUnit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdMan</span><span class="p">,</span><span class="n">ob</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;tdMan&quot;</span><span class="p">)),</span> <span class="n">ob</span><span class="o">.</span><span class="n">getUnit</span><span class="p">(</span><span class="s2">&quot;tdMan&quot;</span><span class="p">)</span>
        <span class="n">wdMan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wdMan</span><span class="p">,</span><span class="n">ob</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;wdMan&quot;</span><span class="p">))</span>
        <span class="n">wsMan</span><span class="p">,</span> <span class="n">wsUnit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wsMan</span><span class="p">,</span><span class="n">ob</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;wsMan&quot;</span><span class="p">)),</span> <span class="n">ob</span><span class="o">.</span><span class="n">getUnit</span><span class="p">(</span><span class="s2">&quot;wsMan&quot;</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">parm_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SIGT_PARAMS</span><span class="p">:</span>
        <span class="n">sigtGeos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
        <span class="n">prSig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prSig</span><span class="p">,</span><span class="n">ob</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;prSigT&quot;</span><span class="p">))</span>
        <span class="n">tpSig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpSig</span><span class="p">,</span><span class="n">ob</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;tpSigT&quot;</span><span class="p">))</span>
        <span class="n">tdSig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdSig</span><span class="p">,</span><span class="n">ob</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;tdSigT&quot;</span><span class="p">))</span>
        <span class="k">continue</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="prepare-the-data">
<h2>4. Prepare the Data<a class="headerlink" href="#prepare-the-data" title="Permalink to this headline">¶</a></h2>
<p>Sort and filter the data to prepare it for plotting.  Then assign units and convert them to degrees Celsius if necessary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort mandatory levels (but not sigT levels) because of the 1000.MB interpolation inclusion</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">prMan</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">wpres</span> <span class="o">=</span> <span class="n">prMan</span><span class="p">[</span><span class="n">ps</span><span class="p">]</span>
<span class="n">direc</span> <span class="o">=</span> <span class="n">wdMan</span><span class="p">[</span><span class="n">ps</span><span class="p">]</span>
<span class="n">spd</span>   <span class="o">=</span> <span class="n">wsMan</span><span class="p">[</span><span class="n">ps</span><span class="p">]</span>
<span class="n">tman</span> <span class="o">=</span> <span class="n">tpMan</span><span class="p">[</span><span class="n">ps</span><span class="p">]</span>
<span class="n">dman</span> <span class="o">=</span> <span class="n">tdMan</span><span class="p">[</span><span class="n">ps</span><span class="p">]</span>

<span class="c1"># Flag missing data</span>
<span class="n">prSig</span><span class="p">[</span><span class="n">prSig</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">tpSig</span><span class="p">[</span><span class="n">tpSig</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">tdSig</span><span class="p">[</span><span class="n">tdSig</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">wpres</span><span class="p">[</span><span class="n">wpres</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">tman</span><span class="p">[</span><span class="n">tman</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">dman</span><span class="p">[</span><span class="n">dman</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">direc</span><span class="p">[</span><span class="n">direc</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">spd</span><span class="p">[</span><span class="n">spd</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="c1"># assign units</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">prSig</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mbar</span>
<span class="n">wpres</span> <span class="o">=</span> <span class="p">(</span><span class="n">wpres</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mbar</span>
<span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">wind_components</span><span class="p">(</span><span class="n">spd</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">knots</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">direc</span><span class="p">))</span>

<span class="k">if</span> <span class="n">tpUnit</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span>
    <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">tpSig</span><span class="o">-</span><span class="mf">273.15</span><span class="p">)</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span>
    <span class="n">Td</span> <span class="o">=</span> <span class="p">(</span><span class="n">tdSig</span><span class="o">-</span><span class="mf">273.15</span><span class="p">)</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span>
    <span class="n">tman</span> <span class="o">=</span> <span class="n">tman</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span>
    <span class="n">dman</span> <span class="o">=</span> <span class="n">dman</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">degC</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="draw-the-plot">
<h2>5. Draw the Plot<a class="headerlink" href="#draw-the-plot" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create SkewT/LogP</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">skew</span> <span class="o">=</span> <span class="n">SkewT</span><span class="p">()</span>
<span class="n">skew</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">skew</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Td</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">skew</span><span class="o">.</span><span class="n">plot_barbs</span><span class="p">(</span><span class="n">wpres</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="n">skew</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">skew</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">title_string</span> <span class="o">=</span> <span class="s2">&quot; T(F)   Td   &quot;</span> 
<span class="n">title_string</span> <span class="o">+=</span>  <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ob</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="s2">&quot;staName&quot;</span><span class="p">))</span>
<span class="n">title_string</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ob</span><span class="o">.</span><span class="n">getDataTime</span><span class="p">()</span><span class="o">.</span><span class="n">getRefTime</span><span class="p">())</span>
<span class="n">title_string</span> <span class="o">+=</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ob</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;staElev&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;m elev)&quot;</span>
<span class="n">title_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;degF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span><span class="mi">1</span><span class="p">))</span>
<span class="n">title_string</span> <span class="o">+=</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">Td</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;degF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title_string</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="c1"># Calculate LCL height and plot as black dot</span>
<span class="n">lcl_pressure</span><span class="p">,</span> <span class="n">lcl_temperature</span> <span class="o">=</span> <span class="n">lcl</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Td</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">skew</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lcl_pressure</span><span class="p">,</span> <span class="n">lcl_temperature</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="c1"># Calculate full parcel profile and add to plot as black line</span>
<span class="n">prof</span> <span class="o">=</span> <span class="n">parcel_profile</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Td</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;degC&#39;</span><span class="p">)</span>
<span class="n">skew</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">prof</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># An example of a slanted line at constant T -- in this case the 0 isotherm</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">skew</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Draw hodograph</span>
<span class="n">ax_hod</span> <span class="o">=</span> <span class="n">inset_axes</span><span class="p">(</span><span class="n">skew</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;30%&#39;</span><span class="p">,</span> <span class="s1">&#39;30%&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">Hodograph</span><span class="p">(</span><span class="n">ax_hod</span><span class="p">,</span> <span class="n">component_range</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">wsMan</span><span class="p">))</span>
<span class="n">h</span><span class="o">.</span><span class="n">add_grid</span><span class="p">(</span><span class="n">increment</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">plot_colormapped</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">spd</span><span class="p">)</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/python-awips-WorkingWithUpperAirObs_12_0.png" src="../../_images/python-awips-WorkingWithUpperAirObs_12_0.png" />
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p>Documentation for:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://unidata.github.io/python-awips/api/DataAccessLayer.html">awips.DataAccessLayer</a></p></li>
<li><p><a class="reference external" href="http://unidata.github.io/python-awips/api/PyGeometryData.html">awips.PyGeometryData</a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/3.3.3/api/_as_gen/matplotlib.pyplot.html">matplotlib.pyplot</a></p></li>
<li><p><a class="reference external" href="https://unidata.github.io/MetPy/latest/api/generated/metpy.plots.SkewT.html">metpy.plots.SkewT</a></p></li>
<li><p><a class="reference external" href="https://unidata.github.io/MetPy/latest/api/generated/metpy.plots.Hodograph.html">metpy.plots.Hodograph</a></p></li>
</ul>
<div class="section" id="related-notebooks">
<h3>Related Notebooks:<a class="headerlink" href="#related-notebooks" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://nbviewer.jupyter.org/github/Unidata/pyaos-ams-2021/blob/master/notebooks/dataAccess/python-awips-HowToAccessData.ipynb">python-awips: How to Access Data</a></p></li>
</ul>
<p><a href="#top">Top</a></p>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="python-awips-WorkingWithSurfaceObs.html" title="previous page">python-awips: Working with Surface Obs</a>
    <a class='right-next' id="next-link" href="../notebook_enhancements.html" title="next page">Enhancing Your Notebooks</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-92978945-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, Unidata. Development supported by National Science Foundation grant AGS-1901712.<br/>
        Last updated on Jan 09, 2021 at 17:40:43.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>
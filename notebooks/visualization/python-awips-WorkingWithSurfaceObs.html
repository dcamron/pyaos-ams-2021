
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>python-awips: Working with Surface Obs &#8212; Unidata AMS 2021 Python Workshop</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&display=swap');
</style>
    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    

    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/theme-unidata.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="python-awips: Working with Upper Air Obs" href="python-awips-WorkingWithUpperAirObs.html" />
    <link rel="prev" title="python-awips: Working with Satellite Data" href="python-awips-WorkingWithSatelliteData.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
  <nav class="navbar navbar-dark navbar-expand-lg bg-unidata fixed-top bd-navbar shadow" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../../index.html">
    
      <img src="../../_static/Unidata_logo_horizontal.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../agenda.html">Agenda</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../setup.html">Workshop Environment</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../projects.html">Project Ideas</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../../resources.html">Resources</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../showcase.html">Workshop Showcase</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/Unidata/pyaos-ams-2021" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/Unidata" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
  </nav>


    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="../dataAccess.html">Data Access Notebooks</a>
                </li>
            
          
            
                <li class="">
                    <a href="../analysis.html">Analysis Notebooks</a>
                </li>
            
          
            
  
                <li class="active">
                    <a href="../visualization.html">Visualization Notebooks</a>
                    <ul>
                    
                        <li class="">
                            <a href="Declarative-Example.html">Declarative Syntax Example</a>
                        </li>
                    
                        <li class="">
                            <a href="MetPy%20SkewT.html">MetPy Skew-T</a>
                        </li>
                    
                        <li class="">
                            <a href="isentropic_introduction.html">Overview of Isentropic Analysis</a>
                        </li>
                    
                        <li class="">
                            <a href="matplotlib-basics.html">Matplotlib: Basics</a>
                        </li>
                    
                        <li class="">
                            <a href="matplotlib-intermediate.html">Matplotlib: Intermediate</a>
                        </li>
                    
                        <li class="">
                            <a href="python-awips-WorkingWithMapsTopoDatabases.html">python-awips: Working with the Maps and Topo Databases</a>
                        </li>
                    
                        <li class="">
                            <a href="python-awips-WorkingWithModels.html">python-awips: Working with Models</a>
                        </li>
                    
                        <li class="">
                            <a href="python-awips-WorkingWithSatelliteData.html">python-awips: Working with Satellite Data</a>
                        </li>
                    
                        <li class="active">
                            <a href="">python-awips: Working with Surface Obs</a>
                        </li>
                    
                        <li class="">
                            <a href="python-awips-WorkingWithUpperAirObs.html">python-awips: Working with Upper Air Obs</a>
                        </li>
                    
                    </ul>
                </li>
            
          
            
                <li class="">
                    <a href="../notebook_enhancements.html">Enhancing Your Notebooks</a>
                </li>
            
          
            
                <li class="">
                    <a href="../index.html">Notebook Index</a>
                </li>
            
          
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#unidata-ams-2021-student-conference" class="nav-link">Unidata AMS 2021 Student Conference</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#focuses" class="nav-link">Focuses</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#objectives" class="nav-link">Objectives</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#imports" class="nav-link">Imports</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#define-data-request" class="nav-link">1. Define Data Request</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#limit-results-based-on-time" class="nav-link">2. Limit Results Based on Time</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#get-the-data-response" class="nav-link">3. Get the Data Response</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#define-color-mapping" class="nav-link">4. Define Color Mapping</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#create-plot-to-draw-on" class="nav-link">5. Create Plot to Draw On</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#colorize-and-draw-temperatures" class="nav-link">6. Colorize and Draw Temperatures!</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#see-also" class="nav-link">See also</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#related-notebooks" class="nav-link">Related Notebooks</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <p><a name="top"></a></p>
<div style="width:1000 px">
<div style="float:right; width:98 px; height:98px;">
<img src="https://raw.githubusercontent.com/Unidata/MetPy/master/src/metpy/plots/_static/unidata_150x150.png" alt="Unidata Logo" style="height: 98px;">
</div>
<div class="section" id="python-awips-working-with-surface-obs">
<h1>python-awips: Working with Surface Obs<a class="headerlink" href="#python-awips-working-with-surface-obs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="unidata-ams-2021-student-conference">
<h2>Unidata AMS 2021 Student Conference<a class="headerlink" href="#unidata-ams-2021-student-conference" title="Permalink to this headline">¶</a></h2>
<div style="clear:both"></div>
</div>
<hr class="docutils" />
<div style="float:right; width:250 px"><img src="../../_static/images/python-awips-surface-obs-preview.png" alt="Colorized surface temps using python-awips" style="height: 300px;"></div>
</div>
<div class="section" id="focuses">
<h2>Focuses<a class="headerlink" href="#focuses" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Create a colored temperature plot for North America using AWIPS METAR observations (datatype <em>obs</em>), similar to existing products in GEMPAK and CAVE.</p></li>
<li><p>Access the data through an EDEX server and limit what’s returned based on geographic extent, and specific parameters we’re interested in.</p></li>
<li><p>Create a color mapping and colorizing the surface data based on our mapping.</p></li>
<li><p>Finally we use matplotlib to plot and display the output.</p></li>
</ul>
</div>
<div class="section" id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#1.-Define-Data-Request">Define Data Request</a></p></li>
<li><p><a class="reference external" href="#2.-Limit-Results-Based-on-Time">Limit Results Based on Time</a></p></li>
<li><p><a class="reference external" href="#3.-Get-the-Data-Response">Get the Data Response</a></p></li>
<li><p><a class="reference external" href="#4.-Define-Color-Mapping">Define Color Mapping</a></p></li>
<li><p><a class="reference external" href="#5.-Create-Plot-to-Draw-On">Create Plot to Draw On</a></p></li>
<li><p><a class="reference external" href="#6.-Colorize-and-Draw-Temperatures%21">Colorize and Draw Temperatures!</a></p></li>
</ol>
</div>
<hr class="docutils" />
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">awips.dataaccess</span> <span class="kn">import</span> <span class="n">DataAccessLayer</span>
<span class="kn">from</span> <span class="nn">dynamicserialize.dstypes.com.raytheon.uf.common.time</span> <span class="kn">import</span> <span class="n">TimeRange</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">metpy.plots</span> <span class="kn">import</span> <span class="n">StationPlot</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="define-data-request">
<h2>1. Define Data Request<a class="headerlink" href="#define-data-request" title="Permalink to this headline">¶</a></h2>
<p>If you read through the <a class="reference external" href="https://nbviewer.jupyter.org/github/Unidata/pyaos-ams-2021/blob/master/notebooks/dataAccess/python-awips-HowToAccessData.ipynb">python-awips: How to Access Data</a> training, you will know that we need to set an EDEX url to access our server, and then we create a data request.  In the previous training, we simply used the ‘datatype’ to define our request, but in this example we will also use an ‘envelope.  Feel free to <a class="reference external" href="http://unidata.github.io/python-awips/api/DataAccessLayer.html#awips.dataaccess.DataAccessLayer.newDataRequest">take a look at the documentation</a> for more information about what arguments can passed through when creating a new data request.</p>
<p>Once the request is made, we’ll also restrict it by setting the parameters of interest, in this case just: “temperature”, “longitute”, “latitude”, and “stationName”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CONUS bounding box and envelope geometry</span>
<span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">55</span><span class="p">]</span>
<span class="n">envelope</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]),(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]),(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>

<span class="c1"># New obs request</span>
<span class="n">edexServer</span> <span class="o">=</span> <span class="s2">&quot;edex-cloud.unidata.ucar.edu&quot;</span>
<span class="n">DataAccessLayer</span><span class="o">.</span><span class="n">changeEDEXHost</span><span class="p">(</span><span class="n">edexServer</span><span class="p">)</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">DataAccessLayer</span><span class="o">.</span><span class="n">newDataRequest</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">envelope</span><span class="o">=</span><span class="n">envelope</span><span class="p">)</span>

<span class="c1"># Set the parameters we care about</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;stationName&quot;</span><span class="p">]</span>
<span class="n">request</span><span class="o">.</span><span class="n">setParameters</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>

<span class="c1"># Take a look at our request</span>
<span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DefaultDataRequest(datatype=obs, identifiers={}, parameters=[&#39;temperature&#39;, &#39;longitude&#39;, &#39;latitude&#39;, &#39;stationName&#39;], levels=[], locationNames=[], envelope=&lt;dynamicserialize.dstypes.com.vividsolutions.jts.geom.Envelope.Envelope object at 0x1635a1250&gt;)
</pre></div>
</div>
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="limit-results-based-on-time">
<h2>2. Limit Results Based on Time<a class="headerlink" href="#limit-results-based-on-time" title="Permalink to this headline">¶</a></h2>
<p>Let’s narrow down our results by creating a time window for the most recent 15 minutes.</p>
<blockquote>
<div><p>Note: You can play around with changing the <code class="docutils literal notranslate"><span class="pre">time_limit</span></code> to see how many observations you get back.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get records from the last 15 minutes</span>
<span class="n">time_limit</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">recentDateTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">time_limit</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">recentDateTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>

<span class="n">beginRange</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span> <span class="n">start</span> <span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<span class="n">endRange</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span> <span class="n">end</span> <span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<span class="n">timerange</span> <span class="o">=</span> <span class="n">TimeRange</span><span class="p">(</span><span class="n">beginRange</span><span class="p">,</span> <span class="n">endRange</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="get-the-data-response">
<h2>3. Get the Data Response<a class="headerlink" href="#get-the-data-response" title="Permalink to this headline">¶</a></h2>
<p>Now we’re going to access the data using <a class="reference external" href="http://unidata.github.io/python-awips/api/DataAccessLayer.html#awips.dataaccess.DataAccessLayer.getGeometryData"><em><strong>DataAccessLayer.getGeometryData()</strong></em></a> and passing in the time range we just defined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get response</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">DataAccessLayer</span><span class="o">.</span><span class="n">getGeometryData</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">timerange</span><span class="p">)</span>
<span class="c1"># Use the response to get the Metar data</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">DataAccessLayer</span><span class="o">.</span><span class="n">getMetarObs</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="c1"># See how much data we got</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; total records&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; temperature records&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 749 total records
Using 745 temperature records
</pre></div>
</div>
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="define-color-mapping">
<h2>4. Define Color Mapping<a class="headerlink" href="#define-color-mapping" title="Permalink to this headline">¶</a></h2>
<p>We’re going to be plotting the station temperature values on a map of the US, and we’ll colorize them based on their value.  So, here we define a dictionary defining temperature ranges and their corresponding colors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A list of colors for the temperatures</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span>

<span class="c1"># A list of the temperature values defining the thresholds</span>
<span class="c1">#  Note: these need to be the same length!</span>
<span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="create-plot-to-draw-on">
<h2>5. Create Plot to Draw On<a class="headerlink" href="#create-plot-to-draw-on" title="Permalink to this headline">¶</a></h2>
<p>Here we create a plot use <a class="reference external" href="https://matplotlib.org/3.3.3/api/_as_gen/matplotlib.pyplot.html"><em><strong>matplotlib.pyplot</strong></em></a> (see the imports at the top of this notebook for reference), and we set our extend using the boundaries we defined in the first second code cell of this notebook.  We also add the coastlines and a title to the plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a plot to draw on</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">()))</span>

<span class="c1"># Use the same bounding box we used on the data request</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

<span class="c1"># Draw the coastlines </span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;50m&#39;</span><span class="p">)</span>

<span class="c1"># Set a title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getDataTime</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot; | Surface Temps (degF) | &quot;</span> <span class="o">+</span> <span class="n">edexServer</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;2021-01-10 00:37:00 | Surface Temps (degF) | edex-cloud.unidata.ucar.edu&#39;)
</pre></div>
</div>
<img alt="../../_images/python-awips-WorkingWithSurfaceObs_12_1.png" src="../../_images/python-awips-WorkingWithSurfaceObs_12_1.png" />
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="colorize-and-draw-temperatures">
<h2>6. Colorize and Draw Temperatures!<a class="headerlink" href="#colorize-and-draw-temperatures" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Suppress nan masking warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span><span class="n">category</span> <span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>

<span class="c1"># get all temperature values and convert them from C to F</span>
<span class="n">tair</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">tair</span><span class="p">[</span><span class="n">tair</span> <span class="o">==</span> <span class="o">-</span><span class="mf">9999.0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;nan&#39;</span>
<span class="n">tair</span> <span class="o">=</span> <span class="p">(</span><span class="n">tair</span><span class="o">*</span><span class="mf">1.8</span><span class="p">)</span><span class="o">+</span><span class="mi">32</span>

<span class="c1"># get all the lats and lons for all the observations</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
<span class="n">lons</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>

<span class="c1"># cycle through each temperature range and plot the corresponding data as appropriate</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
    <span class="c1"># create a new temperature value array</span>
    <span class="n">subtair</span> <span class="o">=</span> <span class="n">tair</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># pair down the temperature values to a subset</span>
    <span class="c1"># if this is the maximum value, then find values greater than it</span>
    <span class="k">if</span> <span class="n">temp</span><span class="o">==</span><span class="nb">max</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
        <span class="n">subtair</span><span class="p">[(</span><span class="n">subtair</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;nan&#39;</span>
    <span class="c1"># if this is the minimum value, then find values less than or equal to it</span>
    <span class="k">elif</span> <span class="n">temp</span><span class="o">==</span><span class="nb">min</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
        <span class="n">subtair</span><span class="p">[(</span><span class="n">subtair</span> <span class="o">&gt;=</span> <span class="n">temp</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;nan&#39;</span>
    <span class="c1"># otherwise find values between it and the next value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subtair</span><span class="p">[(</span><span class="n">subtair</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;nan&#39;</span>
        <span class="n">subtair</span><span class="p">[(</span><span class="n">subtair</span> <span class="o">&gt;=</span> <span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="s1">&#39;nan&#39;</span>

    <span class="c1"># add these stations and their color to the stationplots</span>
    <span class="n">stationplot</span> <span class="o">=</span> <span class="n">StationPlot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">stationplot</span><span class="o">.</span><span class="n">plot_parameter</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">subtair</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># Display the plot with the colorized temperatures</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/python-awips-WorkingWithSurfaceObs_14_0.png" src="../../_images/python-awips-WorkingWithSurfaceObs_14_0.png" />
</div>
</div>
<p><a href="#top">Top</a></p>
</div>
<hr class="docutils" />
<div class="section" id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p>Documentation for:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://unidata.github.io/python-awips/api/DataAccessLayer.html">awips.DataAccessLayer</a></p></li>
<li><p><a class="reference external" href="http://unidata.github.io/python-awips/api/PyGeometryData.html">awips.PyGeometryData</a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/3.3.3/api/_as_gen/matplotlib.pyplot.html">matplotlib.pyplot</a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/3.3.3/api/_as_gen/matplotlib.pyplot.subplot.html">matplotlib.pyplot.subplot</a></p></li>
</ul>
<div class="section" id="related-notebooks">
<h3>Related Notebooks<a class="headerlink" href="#related-notebooks" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://nbviewer.jupyter.org/github/Unidata/pyaos-ams-2021/blob/master/notebooks/dataAccess/python-awips-HowToAccessData.ipynb">python-awips: How to Access Data</a></p></li>
</ul>
<p><a href="#top">Top</a></p>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="python-awips-WorkingWithSatelliteData.html" title="previous page">python-awips: Working with Satellite Data</a>
    <a class='right-next' id="next-link" href="python-awips-WorkingWithUpperAirObs.html" title="next page">python-awips: Working with Upper Air Obs</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-92978945-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, Unidata. Development supported by National Science Foundation grant AGS-1901712.<br/>
        Last updated on Jan 09, 2021 at 17:40:43.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>